# Data Pipeline Implementation Guide (ì˜ˆë‚˜ ë‹´ë‹¹)

ë³¸ ë¬¸ì„œëŠ” ë³¸ í”„ë¡œì íŠ¸ì—ì„œ **ê³µí†µ ë°ì´í„° íŒŒì´í”„ë¼ì¸(íŠ¸ë˜í”½ ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬)** ì„ ë‹´ë‹¹í•˜ëŠ” êµ¬í˜„ ê°€ì´ë“œì´ë‹¤.  
ë”¥ëŸ¬ë‹ ëª¨ë¸ êµ¬í˜„ê³¼ í•™ìŠµ ë¡œì§ì€ ë³¸ ë¬¸ì„œì˜ ë²”ìœ„ì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.

---

## 1. ì˜ˆë‚˜ ë‹´ë‹¹ ë²”ìœ„ ìš”ì•½

### âœ… ë‹´ë‹¹
- íŠ¸ë˜í”½ ë¡œê·¸ ìˆ˜ì§‘ ë˜ëŠ” ìƒì„± (ì‹¤ì¸¡ / í•©ì„±)
- ì›ë³¸ ë¡œê·¸ë¥¼ ì…ë ¥ í…ì„œ Xë¡œ ë³€í™˜
- ê³µí†µ ì…ë ¥ ê·œê²© `(B, N, T, F)` ë³´ì¥

### âŒ ë¹„ë‹´ë‹¹
- í•™ìŠµ íƒ€ê¹ƒ(Y) ìƒì„±
- ëª¨ë¸ êµ¬í˜„ (MLP, LSTM ë“±)
- ì†ì‹¤ í•¨ìˆ˜, í•™ìŠµ, í‰ê°€ ë¡œì§

---

## 2. ì›ë³¸ íŠ¸ë˜í”½ ë¡œê·¸ í¬ë§· (Collector Output)

CollectorëŠ” ì•„ë˜ í˜•ì‹ìœ¼ë¡œ íŠ¸ë˜í”½ ë¡œê·¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì§‘í•œë‹¤.

### 2.1 í•„ìˆ˜ ì»¬ëŸ¼
| ì»¬ëŸ¼ëª… | ì„¤ëª… |
|---|---|
| `timestamp` | íŠ¸ë˜í”½ ìˆ˜ì§‘ ì‹œê° |
| `node_id` | ë…¸ë“œ ì‹ë³„ì (`node_0`, `node_1`, ...) |
| `bytes` | í•´ë‹¹ interval ë™ì•ˆ ì „ì†¡ëœ ë°”ì´íŠ¸ ìˆ˜ |

> `packets` ì»¬ëŸ¼ì€ ì„ íƒ ì‚¬í•­ì´ë©° ì—†ì–´ë„ ë™ì‘í•´ì•¼ í•œë‹¤.

### 2.2 ì˜ˆì‹œ ë¡œê·¸
```text
2026-01-09 10:00:00, node_0, 120000
2026-01-09 10:00:00, node_1,  80000
2026-01-09 10:00:00, node_2, 100000
2026-01-09 10:00:05, node_0, 140000
2026-01-09 10:00:05, node_1,  90000
2026-01-09 10:00:05, node_2, 110000
```

---

## 3. ì „ì²˜ë¦¬ ëª©í‘œ (Preprocessing Goal)

ì „ì²˜ë¦¬ì˜ ëª©ì ì€ **ì›ë³¸ íŠ¸ë˜í”½ ë¡œê·¸ë¥¼ ë”¥ëŸ¬ë‹ ëª¨ë¸ í•™ìŠµì´ ê°€ëŠ¥í•œ ì…ë ¥ í…ì„œë¡œ ë³€í™˜**í•˜ëŠ” ê²ƒì´ë‹¤.

### ê³µí†µ ì…ë ¥ í…ì„œ ê·œê²©
```text
X.shape = (B, N, T, F)
```

| ì°¨ì› | ì˜ë¯¸ |
|---|---|
| B | ë°°ì¹˜ í¬ê¸° |
| N | ë…¸ë“œ ê°œìˆ˜ |
| T | ê³¼ê±° ìœˆë„ìš° ê¸¸ì´ |
| F | feature ìˆ˜ (ê¸°ë³¸: 1 â†’ bytes) |

---

## 4. ì „ì²˜ë¦¬ êµ¬í˜„ ì˜ˆì‹œ ì½”ë“œ

ì•„ë˜ ì½”ë“œëŠ” **ì „ì²˜ë¦¬ ì „ì²´ íë¦„ì„ ì´í•´í•˜ê¸° ìœ„í•œ ìµœì†Œ ì˜ˆì‹œ ì½”ë“œ**ì´ë‹¤.

### Step 1. ë¡œê·¸ ë¡œë“œ
```python
import pandas as pd

df = pd.read_csv(
    "traffic_log.csv",
    names=["timestamp", "node_id", "bytes"]
)
df["timestamp"] = pd.to_datetime(df["timestamp"])
```

### Step 2. Pivot (ì‹œê°„ Ã— ë…¸ë“œ ì •ë ¬)

ì›ë³¸ ë¡œê·¸ë¥¼ **ì‹œê°„ì„ í–‰(index)**, **ë…¸ë“œë¥¼ ì—´(column)**ë¡œ ì¬êµ¬ì„±í•œë‹¤.

```python
pivot = df.pivot(
    index="timestamp",
    columns="node_id",
    values="bytes"
).sort_index()

pivot = pivot.fillna(0)
```

### Step 3. ìŠ¬ë¼ì´ë”© ìœˆë„ìš° ìƒì„±
```python
import numpy as np

window_size = 12
values = pivot.values

X_list = []
for i in range(len(values) - window_size + 1):
    window = values[i:i + window_size]
    X_list.append(window)

X = np.array(X_list)
```

### Step 4. ê³µí†µ ì…ë ¥ í…ì„œ í˜•íƒœë¡œ ë³€í™˜
```python
X = np.transpose(X, (0, 2, 1))
X = X[..., np.newaxis]
```

---

## 5. ì „ì²˜ë¦¬ ê²°ê³¼ í•´ì„

```text
X[b, n, :, 0]
```

ì˜ë¯¸:
- ë°°ì¹˜ bì—ì„œ
- në²ˆ ë…¸ë“œì˜
- ìµœê·¼ Tê°œ ì‹œì ì˜ íŠ¸ë˜í”½(bytes) ì‹œê³„ì—´

---

## 6. ìµœì¢… ì‚°ì¶œë¬¼

### ğŸ“¦ ì‚°ì¶œë¬¼
- ì…ë ¥ í…ì„œ `X` (NumPy array ë˜ëŠ” `.npz`)
- ì…ë ¥ í…ì„œ ê·œê²© ë¬¸ì„œ (`(B, N, T, F)` ëª…ì‹œ)

### ğŸ“ ì €ì¥ ìœ„ì¹˜ ì˜ˆì‹œ
```text
data/processed/X_train.npz
```

---

## 7. êµ¬í˜„ ì‹œ ìœ ì˜ì‚¬í•­

- ë…¸ë“œ ìˆœì„œëŠ” í•­ìƒ ê³ ì • (`node_0 â†’ node_1 â†’ ...`)
- ë™ì¼ timestampì—ì„œ ëˆ„ë½ëœ ë…¸ë“œëŠ” 0ìœ¼ë¡œ ì²˜ë¦¬
- ëª¨ë¸ ë‚´ë¶€ êµ¬ì¡° ë° í•™ìŠµ ë¡œì§ì€ ê³ ë ¤í•˜ì§€ ì•ŠìŒ
